import{b as Q,c as T,j as e,u as P,z as f}from"./vendor-CSTohHpX.js";import{r as x}from"./react-B9B04VyU.js";import{u as L,b as $,e as E}from"./index-C_gttvLM.js";import{i as D,B as N,I as U,T as I}from"./label-LGuvYSfd.js";import{L as C,N as M,Q as O,F as z}from"./footer-DiVLYYck.js";import{u as R,D as B,a as K,b as V,c as Y,d as G,F as H,e as v,f as y,g as w,h as S,S as _,i as J,j as W,k as X,l as Z,t as q}from"./zod-CLErJloe.js";function ee({questions:r,isLoading:h}){const{toast:d}=L();$();const j=Q(),[n,g]=x.useState(null),l=T({mutationFn:async({questionId:s,type:a})=>{await E("POST",`/api/forum/questions/${s}/vote`,{type:a})},onSuccess:()=>{j.invalidateQueries({queryKey:["/api/forum/questions"]})},onError:s=>{if(D(s)){d({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}d({title:"Error",description:"Failed to vote. Please try again.",variant:"destructive"})}}),m=(s,a)=>{l.mutate({questionId:s,type:a})},p=s=>{g(n===s?null:s)},u=s=>{var a;return((a=C.find(o=>o.value===s))==null?void 0:a.label)||s},i=s=>{const a=new Date(s),t=Math.floor((new Date().getTime()-a.getTime())/(1e3*60*60));return t<1?"Just now":t<24?`${t}h ago`:t<24*7?`${Math.floor(t/24)}d ago`:a.toLocaleDateString()},b=s=>{switch(s){case"answered":return"text-accent bg-accent/20";case"closed":return"text-muted-foreground bg-muted/20";default:return"text-primary bg-primary/20"}};return h?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"neu-card p-6 animate-pulse",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-muted rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-muted rounded w-1/2"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-3 bg-muted rounded w-16"}),e.jsx("div",{className:"h-3 bg-muted rounded w-16"}),e.jsx("div",{className:"h-3 bg-muted rounded w-16"})]})]})]})},s))}):!r||r.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("i",{className:"fas fa-comments text-muted-foreground text-6xl mb-6"}),e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"No Questions Found"}),e.jsx("p",{className:"text-muted-foreground mb-8",children:"Be the first to ask a question in this category!"}),e.jsxs("button",{className:"btn-primary","data-testid":"button-ask-first-question",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Ask the First Question"]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Recent Questions"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[r.length," question",r.length!==1?"s":""," found"]})]}),e.jsx("div",{className:"space-y-4",children:r.map(s=>{var a,o,t,c,k,F,A;return e.jsxs("div",{className:"neu-card p-6 interactive","data-testid":`question-${s.id}`,children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:(a=s.user)!=null&&a.profileImageUrl?e.jsx("img",{src:s.user.profileImageUrl,alt:s.user.firstName||s.user.email,className:"w-12 h-12 rounded-full object-cover"}):e.jsx("div",{className:"w-12 h-12 bg-primary rounded-full flex items-center justify-center text-primary-foreground font-bold",children:(((t=(o=s.user)==null?void 0:o.firstName)==null?void 0:t[0])||((k=(c=s.user)==null?void 0:c.email)==null?void 0:k[0])||"U").toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 cursor-pointer hover:text-primary transition-colors",onClick:()=>p(s.id),"data-testid":`question-title-${s.id}`,children:s.title}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["by ",((F=s.user)==null?void 0:F.firstName)||((A=s.user)==null?void 0:A.email)||"Anonymous"]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:i(s.createdAt)}),e.jsx("span",{className:`text-xs px-2 py-1 rounded ${b(s.status)}`,children:s.status})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"text-xs bg-secondary/50 text-secondary-foreground px-2 py-1 rounded",children:u(s.category)}),s.featured&&e.jsxs("span",{className:"text-xs bg-accent/20 text-accent px-2 py-1 rounded",children:[e.jsx("i",{className:"fas fa-star mr-1"}),"Featured"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[e.jsx("i",{className:"fas fa-eye mr-1"}),s.viewsCount," views"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[e.jsx("i",{className:"fas fa-reply mr-1"}),s.answersCount," answers"]})]})]}),e.jsx("div",{className:"text-muted-foreground mb-4",children:n===s.id?e.jsx("p",{className:"whitespace-pre-wrap",children:s.content}):e.jsx("p",{className:"line-clamp-2",children:s.content.length>150?s.content.substring(0,150)+"...":s.content})}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>m(s.id,"up"),disabled:l.isPending,className:"flex items-center gap-1 text-sm hover:text-primary transition-colors","data-testid":`upvote-${s.id}`,children:[e.jsx("i",{className:"fas fa-thumbs-up"}),s.upvotes]}),e.jsxs("button",{onClick:()=>m(s.id,"down"),disabled:l.isPending,className:"flex items-center gap-1 text-sm hover:text-destructive transition-colors","data-testid":`downvote-${s.id}`,children:[e.jsx("i",{className:"fas fa-thumbs-down"}),s.downvotes]})]}),e.jsx("button",{onClick:()=>p(s.id),className:"text-sm text-primary hover:underline","data-testid":`toggle-expand-${s.id}`,children:n===s.id?"Show Less":"Read More"}),e.jsxs("button",{className:"text-sm text-accent hover:underline","data-testid":`answer-${s.id}`,children:[e.jsx("i",{className:"fas fa-reply mr-1"}),"Answer"]}),e.jsxs("button",{className:"text-sm text-muted-foreground hover:text-foreground transition-colors","data-testid":`share-${s.id}`,children:[e.jsx("i",{className:"fas fa-share mr-1"}),"Share"]})]})]})]}),n===s.id&&s.answersCount>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-border",children:[e.jsxs("h4",{className:"font-semibold mb-4",children:["Answers (",s.answersCount,")"]}),e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx("i",{className:"fas fa-comments text-2xl mb-2"}),e.jsx("p",{children:"Answer loading functionality will be implemented here"})]})]})]},s.id)})}),r.length>=20&&e.jsx("div",{className:"text-center pt-8",children:e.jsxs("button",{className:"btn-secondary","data-testid":"button-load-more",children:[e.jsx("i",{className:"fas fa-chevron-down mr-2"}),"Load More Questions"]})})]})}const se=f.object({title:f.string().min(10,"Title must be at least 10 characters"),content:f.string().min(50,"Content must be at least 50 characters"),category:f.string().min(1,"Please select a category")});function oe(){const{toast:r}=L(),{isAuthenticated:h,isLoading:d}=$(),j=Q(),[n,g]=x.useState(""),[l,m]=x.useState(""),[p,u]=x.useState(!1),i=R({resolver:q(se),defaultValues:{title:"",content:"",category:""}});x.useEffect(()=>{if(!d&&!h){r({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}},[h,d,r]);const{data:b,isLoading:s}=P({queryKey:["/api/forum/questions",n,l]}),a=T({mutationFn:async t=>{await E("POST","/api/forum/questions",t)},onSuccess:()=>{j.invalidateQueries({queryKey:["/api/forum/questions"]}),u(!1),i.reset(),r({title:"Success",description:"Your question has been posted successfully."})},onError:t=>{if(D(t)){r({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}r({title:"Error",description:"Failed to post question. Please try again.",variant:"destructive"})}}),o=t=>{a.mutate(t)};return d?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"neu-card p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})}):e.jsxs("div",{className:"min-h-screen bg-background text-foreground",children:[e.jsx(M,{}),e.jsx("main",{className:"py-20 px-4 lg:px-8",children:e.jsxs("div",{className:"container mx-auto",children:[e.jsxs("section",{className:"text-center mb-16",children:[e.jsxs("h1",{className:"text-4xl lg:text-6xl font-bold leading-tight mb-6",children:[e.jsx("span",{className:"gradient-text",children:"Legal Q&A Forum"}),e.jsx("br",{}),e.jsx("span",{className:"text-foreground",children:"Community Support"})]}),e.jsx("p",{className:"text-xl text-muted-foreground max-w-3xl mx-auto mb-8",children:"Get answers from legal experts and community members. Ask questions, share knowledge, and help others navigate Kenya's legal landscape."}),e.jsxs(B,{open:p,onOpenChange:u,children:[e.jsx(K,{asChild:!0,children:e.jsxs(N,{className:"btn-primary text-lg px-8 py-4","data-testid":"button-ask-question",children:[e.jsx("i",{className:"fas fa-plus mr-2"}),"Ask a Question"]})}),e.jsxs(V,{className:"max-w-2xl",children:[e.jsx(Y,{children:e.jsx(G,{children:"Ask a Legal Question"})}),e.jsx(H,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(o),className:"space-y-6",children:[e.jsx(v,{control:i.control,name:"title",render:({field:t})=>e.jsxs(y,{children:[e.jsx(w,{children:"Question Title"}),e.jsx(S,{children:e.jsx(U,{placeholder:"Briefly describe your legal question...",...t,"data-testid":"input-question-title"})})]})}),e.jsx(v,{control:i.control,name:"category",render:({field:t})=>e.jsxs(y,{children:[e.jsx(w,{children:"Category"}),e.jsxs(_,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(S,{children:e.jsx(J,{"data-testid":"select-question-category",children:e.jsx(W,{placeholder:"Select a category"})})}),e.jsx(X,{children:C.map(c=>e.jsx(Z,{value:c.value,children:c.label},c.value))})]})]})}),e.jsx(v,{control:i.control,name:"content",render:({field:t})=>e.jsxs(y,{children:[e.jsx(w,{children:"Question Details"}),e.jsx(S,{children:e.jsx(I,{placeholder:"Provide detailed information about your situation, relevant facts, and what specific advice you're seeking...",className:"min-h-[120px]",...t,"data-testid":"textarea-question-content"})})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>u(!1),"data-testid":"button-cancel-question",children:"Cancel"}),e.jsx(N,{type:"submit",disabled:a.isPending,"data-testid":"button-submit-question",children:a.isPending?"Posting...":"Post Question"})]})]})})]})]})]}),e.jsx("section",{className:"mb-12",children:e.jsx("div",{className:"glass-panel p-6 max-w-6xl mx-auto",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Filter by Category"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>g(""),className:`p-2 rounded text-sm transition-colors ${n===""?"bg-primary text-primary-foreground":"bg-secondary/50 hover:bg-secondary"}`,"data-testid":"filter-category-all",children:"All Categories"}),C.map(t=>e.jsx("button",{onClick:()=>g(t.value),className:`p-2 rounded text-sm transition-colors ${n===t.value?"bg-primary text-primary-foreground":"bg-secondary/50 hover:bg-secondary"}`,"data-testid":`filter-category-${t.value}`,children:t.label},t.value))]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Filter by Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>m(""),className:`p-2 rounded text-sm transition-colors ${l===""?"bg-accent text-accent-foreground":"bg-secondary/50 hover:bg-secondary"}`,"data-testid":"filter-status-all",children:"All Status"}),O.map(t=>e.jsx("button",{onClick:()=>m(t.value),className:`p-2 rounded text-sm transition-colors ${l===t.value?"bg-accent text-accent-foreground":"bg-secondary/50 hover:bg-secondary"}`,"data-testid":`filter-status-${t.value}`,children:t.label},t.value))]})]})]})})}),e.jsx(ee,{questions:b||[],isLoading:s})]})}),e.jsx(z,{})]})}export{oe as default};
